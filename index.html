<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Number Match — HTML</title>
  <style>
    :root{
      --bg:#0f1220; /* deep indigo */
      --panel:#171a2b;
      --ink:#e7ecff;
      --muted:#9aa3c7;
      --accent:#7aa2ff;
      --accent-2:#19d2b8;
      --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0e1120,#0a0d16 60%);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;-webkit-tap-highlight-color:transparent}
    .app{max-width:680px;margin:0 auto;padding:12px 12px 86px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:8px 0 12px}
    .title{font-weight:800;letter-spacing:.5px}
    .score-box{display:flex;gap:10px;align-items:center}
    .pill{background:var(--panel);padding:8px 12px;border-radius:999px;font-size:14px;color:var(--muted)}.pill b{color:var(--ink)}
    .board-wrap{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:8px 8px 12px}
    .row{display:grid;grid-template-columns:repeat(var(--cols),1fr);gap:6px;margin:6px 8px}
    #board{padding-bottom:6px}
    .cell{position:relative;display:flex;align-items:center;justify-content:center;border-radius:12px;user-select:none;-webkit-user-select:none;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);aspect-ratio:1/1;font-weight:800;font-size:clamp(18px,8vw,28px);transition:.12s transform ease,.12s background-color ease,.12s border-color ease,.12s box-shadow ease}
    .cell:active{transform:scale(.98)}
    .cell.empty{opacity:.18;background:transparent;border-style:dashed}
    /* Підсвітку можливих ходів вимкнено */
    .cell.selectable{}
    .cell.selected{background:rgba(122,162,255,.16);border-color:var(--accent);box-shadow:0 0 0 2px var(--accent) inset}
    .cell.good{animation:flash .35s ease}
    .cell.bad{animation:shake .28s ease}
    .cell .num{filter:drop-shadow(0 1px 0 rgba(0,0,0,.25))}
    .cell .num.dark{color:#9fb4ff}
    @keyframes flash{0%{background:rgba(25,210,184,.1)}70%{background:rgba(25,210,184,.35)}100%{background:rgba(25,210,184,.1)}}
    @keyframes shake{0%,100%{transform:translateX(0)}30%{transform:translateX(-2px)}60%{transform:translateX(2px)}}
    .controls{position:sticky;bottom:0;left:0;right:0;backdrop-filter:blur(8px);background:linear-gradient(180deg,rgba(15,18,32,0),rgba(13,16,28,.9) 30%,rgba(13,16,28,.98));padding:10px 8px 16px;border-top:1px solid rgba(255,255,255,.06)}
    .bar{max-width:680px;margin:0 auto;display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    button{appearance:none;border:0;border-radius:14px;padding:14px 12px;font-weight:700;color:#0b0e1a;background:var(--accent);box-shadow:0 6px 18px rgba(122,162,255,.25);font-size:16px}
    button.secondary{background:#2a2f4b;color:var(--ink);box-shadow:none;border:1px solid rgba(255,255,255,.08)}
    button.ghost{background:transparent;color:var(--ink);border:1px dashed rgba(255,255,255,.2)}
    button.warn{background:var(--danger);color:#fff}
    button:disabled{opacity:.5;filter:grayscale(20%)}
    .topbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .badge{display:inline-flex;align-items:center;gap:6px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:999px;font-size:12px;color:var(--muted)}
    .badge .dot{width:8px;height:8px;border-radius:50%;background:var(--accent-2)}
    .help{margin:10px 8px 0;font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="topbar">
        <div class="title">
          <div style="font-size:12px;color:var(--muted);line-height:1">Mini-грайлик</div>
          <div style="font-size:20px">Number Match</div>
        </div>
        <span class="badge"><span class="dot"></span>Мобільна версія</span>
      </div>
      <div class="score-box">
        <div class="pill">Очки: <b id="score">0</b></div>
        <div class="pill">Етап: <b id="stage">1</b></div>
      </div>
    </header>

    <div class="board-wrap">
      <div class="help">Правила: знищуй пари <b>однакових чисел</b> або тих, що <b>у сумі дають 10</b>. Пара має бути <b>в одному рядку або колонці</b> і між ними не повинно бути інших чисел (порожні клітинки дозволені). Коли застряг — додай рядок.</div>
      <div id="board"></div>
    </div>

    <div class="controls">
      <div class="bar">
        <button id="btnAdd">+ Рядок</button>
        <button id="btnHint" class="secondary">Підказка</button>
        <button id="btnUndo" class="secondary">Відміна</button>
        <button id="btnNew" class="ghost">Нова гра</button>
      </div>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', ()=>{
    const COLS = 9;         // кількість колонок
    const INITIAL_ROWS = 7; // стартова висота
    const SCORE_PAIR = 10;

    const elBoard = document.getElementById('board');
    const elScore = document.getElementById('score');
    const elStage = document.getElementById('stage');

    const state = {
      grid: [],          // масив рядків; 0 = порожньо
      score: 0,
      stage: 1,
      selection: null,   // {r,c,v}
      history: [],       // для відміни
      seed: Date.now()
    }

    function rng(){ // простий PRNG для відтворюваності між сесіями
      state.seed ^= state.seed << 13; state.seed ^= state.seed >> 17; state.seed ^= state.seed << 5;
      return Math.abs(state.seed) / 0x7fffffff;
    }
    const rand1to9 = () => 1 + Math.floor(rng()*9);

    function save(){
      try{ localStorage.setItem('nm_state', JSON.stringify(state)); }catch{}
    }
    function load(){
      try{
        const raw = localStorage.getItem('nm_state');
        if(!raw) return false;
        const s = JSON.parse(raw);
        if(!s || !Array.isArray(s.grid)) return false;
        Object.assign(state, s);
        return true;
      }catch{ return false }
    }

    function newGame(){
      state.grid = Array.from({length: INITIAL_ROWS}, ()=> Array.from({length: COLS}, rand1to9));
      state.stage = 1; state.score = 0; state.selection = null; state.history = []; state.seed = Date.now();
      render(); save();
    }

    function render(){
      elBoard.innerHTML = '';
      elScore.textContent = state.score;
      elStage.textContent = state.stage;
      for(let r=0;r<state.grid.length;r++){
        const row = document.createElement('div');
        row.className = 'row';
        row.style.setProperty('--cols', COLS);
        for(let c=0;c<COLS;c++){
          const v = state.grid[r]?.[c]||0;
          const cell = document.createElement('div');
          cell.className = 'cell' + (v===0 ? ' empty' : '');
          cell.dataset.r = r; cell.dataset.c = c; cell.tabIndex = 0;
          if(v!==0){
            const num = document.createElement('div');
            num.className = 'num' + (v>=7? ' dark':'');
            num.textContent = v;
            cell.appendChild(num);
          }
          cell.addEventListener('click', onCellClick);
          row.appendChild(cell);
        }
        elBoard.appendChild(row);
      }
      updateSelectableHints();
    }

    function canPair(r1,c1,r2,c2){
      if(r1===r2 && c1===c2) return false;
      const v1 = get(r1,c1), v2 = get(r2,c2);
      if(!v1 || !v2) return false;
      const goodValue = (v1===v2) || (v1+v2===10);
      if(!goodValue) return false;
      if(r1===r2){
        const [a,b] = c1<c2 ? [c1,c2] : [c2,c1];
        for(let c=a+1;c<b;c++){ if(get(r1,c)!==0) return false; }
        return true;
      }
      if(c1===c2){
        const [a,b] = r1<r2 ? [r1,r2] : [r2,r1];
        for(let r=a+1;r<b;r++){ if(get(r,c1)!==0) return false; }
        return true;
      }
      return false;
    }

    function get(r,c){
      if(r<0||c<0||r>=state.grid.length||c>=COLS) return 0;
      return state.grid[r][c]||0;
    }
    function set(r,c,val){ state.grid[r][c]=val }

    function onCellClick(e){
      const cell = e.currentTarget;
      const r = +cell.dataset.r; const c = +cell.dataset.c;
      const v = get(r,c); if(!v) return;
      if(!state.selection){
        state.selection = {r,c,v};
        cell.classList.add('selected');
        return;
      }
      const {r:rr,c:cc} = state.selection;
      if(rr===r && cc===c){
        state.selection = null;
        cell.classList.remove('selected');
        return;
      }
      const ok = canPair(rr,cc,r,c);
      const cellA = qCell(rr,cc);
      if(ok){
        pushHistory();
        set(rr,cc,0); set(r,c,0);
        flash(cellA,'good'); flash(cell,'good');
        state.score += SCORE_PAIR;
        compactTrailingEmptyRows();
        state.selection = null;
        render();
        save();
      } else {
        flash(cellA,'bad'); flash(cell,'bad');
        state.selection = {r,c,v};
        document.querySelectorAll('.cell.selected').forEach(n=>n.classList.remove('selected'));
        cell.classList.add('selected');
      }
    }

    function qCell(r,c){ return elBoard.querySelector(`.cell[data-r="${r}"][data-c="${c}"]`) }
    function flash(el,cls){ if(!el) return; el.classList.remove(cls); void el.offsetWidth; el.classList.add(cls) }

    function compactTrailingEmptyRows(){
      for(let i=state.grid.length-1;i>=0;i--){
        if(state.grid[i].every(v=>v===0)) state.grid.pop(); else break;
      }
      if(state.grid.length===0){
        state.stage++;
        state.grid = Array.from({length: INITIAL_ROWS+state.stage-1}, ()=> Array.from({length: COLS}, rand1to9));
      }
    }

    document.getElementById('btnAdd').addEventListener('click',()=>{
      pushHistory();
      const row = Array.from({length: COLS}, rand1to9);
      state.grid.push(row);
      render(); save();
    })

    document.getElementById('btnNew').addEventListener('click',()=>{
      newGame();
    })

    document.getElementById('btnUndo').addEventListener('click',()=>{
      const prev = state.history.pop();
      if(!prev) return;
      Object.assign(state, JSON.parse(prev));
      render(); save();
    })

    document.getElementById('btnHint').addEventListener('click',()=>{
      const hint = findAnyMove();
      if(!hint){
        alert('Немає доступних ходів. Додай рядок!');
        return;
      }
      const [a,b] = hint;
      const ca = qCell(a.r,a.c), cb = qCell(b.r,b.c);
      ca && ca.classList.add('selected');
      cb && cb.classList.add('selected');
      setTimeout(()=>{ ca && ca.classList.remove('selected'); cb && cb.classList.remove('selected'); }, 900);
    })

    function updateSelectableHints(){
      // Підсвітку вимкнено: лише прибираємо можливі сліди
      document.querySelectorAll('.cell').forEach(cell=>{ cell.classList.remove('selectable'); });
    }

    function findAnyMove(){
      for(let r=0;r<state.grid.length;r++){
        for(let c=0;c<COLS;c++){
          const v = get(r,c); if(!v) continue;
          for(let c2=c+1;c2<COLS;c2++){
            const v2 = get(r,c2); if(v2===0) continue;
            if((v===v2 || v+v2===10) && canPair(r,c,r,c2)) return [{r,c,v},{r:r,c:c2,v:v2}];
            break;
          }
          for(let r2=r+1;r2<state.grid.length;r2++){
            const v2 = get(r2,c); if(v2===0) continue;
            if((v===v2 || v+v2===10) && canPair(r,c,r2,c)) return [{r,c,v},{r:r2,c,v:v2}];
            break;
          }
        }
      }
      return null;
    }

    function pushHistory(){
      const clone = JSON.stringify({grid: state.grid.map(r=>r.slice()), score: state.score, stage: state.stage, seed: state.seed});
      state.history.push(clone);
      if(state.history.length>20) state.history.shift();
    }

    function mount(){
      if(!load()) newGame(); else render();
      const resize = ()=>{
        const rows = document.querySelectorAll('.row');
        rows.forEach(r=>{ r.style.gridAutoRows = '1fr'; });
      }
      window.addEventListener('resize', resize); resize();
    }

    mount();
  });
  </script>
</body>
</html>
