<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Number Match</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f0f0;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 20px;
  }
  h1 { margin-bottom: 10px; text-align: center; }
  #game { display: grid; grid-template-columns: repeat(8, auto); margin-top: 20px; border: 1px solid #d0d0d0; }
  .cell {
    background: #fff; border: 1px solid #d0d0d0;
    display: flex; justify-content: center; align-items: center;
    font-size: 30px; cursor: pointer; user-select: none;
    min-width: 38px; min-height: 38px; padding: 3px;
    transition: background 0.3s, transform 0.2s;
  }
  .cell.selected { background: #87cefa; transform: scale(1.05); }

  @keyframes bounceHint { 0% { transform: translateY(0); } 30% { transform: translateY(-15px); } 50% { transform: translateY(0); } 70% { transform: translateY(-8px); } 100% { transform: translateY(0); } }
  @keyframes pulseRed { 0% { background: #ffcccc; transform: translateY(0); } 30% { background: #ff6666; transform: translateY(-10px); } 50% { background: #ff9999; transform: translateY(0); } 70% { background: #ff6666; transform: translateY(-5px); } 100% { background: #ffcccc; transform: translateY(0); } }
  .cell.hint { background: #90ee90; animation: bounceHint 0.8s ease-out; }
  .cell.wrong { animation: pulseRed 0.8s ease-out; }

  #level { margin-top: 20px; font-size: 18px; }
  #message { margin-top: 10px; font-size: 16px; color: #d9534f; }

  .icon-bar { display: flex; gap: 14px; margin-top: 10px; }
  .icon-button { background: none; border: none; cursor: pointer; padding: 6px; transition: transform 0.2s ease; }
  .icon-button svg { stroke: #333; width: 32px; height: 32px; transform: none; }
  @media (hover: hover) and (pointer: fine) { .icon-button:not(.rotate-animation):hover svg { transform: scale(1.15); } }
  @keyframes blink { 0%,100% { stroke: #FFD700; transform: scale(1); } 50% { stroke: #FFA500; transform: scale(1.2); } }
  .blinking svg { animation: blink 1s infinite; }
  @keyframes rotate360 { 0% { transform: rotate(0deg); } 50% { transform: rotate(360deg); } 100% { transform: rotate(0deg); } }
  .rotate-animation svg { animation: rotate360 0.6s ease; }
  #game-container { position: relative; display: inline-block; }
</style>
</head>
<body>

<h1>Number Match</h1>
<div id="level">Рівень: 1</div>
<div id="game-container"><div id="game"></div></div>
<div id="message"></div>

<div class="icon-bar">
  <button id="restartBtn" class="icon-button" title="Перезапустити гру">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="#333" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="1 4 1 10 7 10"></polyline>
      <path d="M3.51 15a9 9 0 1 0 3.13-9.36L1 10"></path>
    </svg>
  </button>
  <button class="icon-button" title="Додати рядок">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="#333" stroke-linecap="round" stroke-linejoin="round">
      <line x1="12" y1="5" x2="12" y2="19"></line>
      <line x1="5" y1="12" x2="19" y2="12"></line>
    </svg>
  </button>
  <button id="hintBtn" class="icon-button" title="Підказка">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="#333" stroke-linecap="round" stroke-linejoin="round">
      <path d="M9 18h6M10 22h4M12 2a7 7 0 0 1 7 7c0 2.485-1.5 4.5-3 6a4 4 0 0 0-1 3H11a4 4 0 0 0-1-3c-1.5-1.5-3-3.515-3-6a7 7 0 0 1 7-7z"/>
    </svg>
  </button>
</div>

<script>
class NumberMatchGame {
  constructor(rows=10, cols=8){
    this.rows=rows; this.cols=cols; this.level=1;
    this.numbers=[]; this.selected=[]; this.blocked=false;
    this.gameEl=document.getElementById('game');
    this.levelEl=document.getElementById('level');
    this.messageEl=document.getElementById('message');
    this.hintBtn=document.getElementById('hintBtn');

    this.restartBtn=document.getElementById('restartBtn');
    this.addRowBtn=document.querySelectorAll('.icon-bar .icon-button')[1];

    this.setupButtons();
    this.startGame();
  }

  setupButtons(){
    this.restartBtn.onclick=()=>{ this.animateIcon(this.restartBtn,'rotate'); this.startGame(); };
    this.addRowBtn.onclick=()=>{ this.animateIcon(this.addRowBtn,'bounce'); this.addRow(); };
    this.hintBtn.onclick=()=>{ this.animateIcon(this.hintBtn,'blink'); this.showHint(); };
  }

  animateIcon(button,type){
    const svg=button.querySelector('svg');
    if(type==='rotate'){ button.classList.add('rotate-animation'); setTimeout(()=>button.classList.remove('rotate-animation'),600); }
    else if(type==='bounce'){ svg.style.transform="scale(1.4)"; setTimeout(()=>svg.style.transform="",400); }
    else if(type==='blink'){ svg.style.stroke="#FFD700"; svg.style.transform="scale(1.2)"; setTimeout(()=>{ svg.style.stroke="#333"; svg.style.transform=""; },400); }
  }

  animateCell(cell,cls,duration=800,callback=null){ cell.classList.add(cls); setTimeout(()=>{ cell.classList.remove(cls); if(callback) callback(); },duration); }

  startGame(){
    this.numbers=[]; this.selected=[]; this.blocked=false; this.messageEl.textContent='';
    for(let i=0;i<this.rows*this.cols;i++) this.numbers.push(i<5*this.cols?Math.floor(Math.random()*9)+1:null);
    this.renderGrid();
    this.updateHintBlink();
  }

  renderGrid(){
    this.gameEl.innerHTML='';
    this.numbers.forEach((num,idx)=>{
      const cell=document.createElement('div'); cell.classList.add('cell'); if(num!==null) cell.textContent=num;
      cell.addEventListener('click',()=>this.selectCell(idx));
      this.gameEl.appendChild(cell);
    });
    this.updateHintBlink();
  }

  selectCell(idx){
    if(this.numbers[idx]===null||this.blocked) return;
    const cells=this.gameEl.querySelectorAll('.cell');
    if(this.selected.includes(idx)){ cells[idx].classList.remove('selected'); this.selected=this.selected.filter(i=>i!==idx); return; }
    if(this.selected.length<2){ this.selected.push(idx); cells[idx].classList.add('selected'); }
    if(this.selected.length===2){ this.blocked=true; setTimeout(()=>this.checkMatch(),300); }
  }

  canConnect(i1,i2){
    const r1=Math.floor(i1/this.cols), c1=i1%this.cols, r2=Math.floor(i2/this.cols), c2=i2%this.cols;
    if(Math.abs(r1-r2)<=1&&Math.abs(c1-c2)<=1) return true;
    if(r1===r2){ for(let c=Math.min(c1,c2)+1;c<Math.max(c1,c2);c++) if(this.numbers[r1*this.cols+c]!==null) return false; return true; }
    if(c1===c2){ for(let r=Math.min(r1,r2)+1;r<Math.max(r1,r2);r++) if(this.numbers[r*this.cols+c1]!==null) return false; return true; }
    if(Math.abs(r1-r2)===Math.abs(c1-c2)){
      let r=r1<r2?1:-1, c=c1<c2?1:-1, rr=r1+r, cc=c1+c;
      while(rr!==r2&&cc!==c2){ if(this.numbers[rr*this.cols+cc]!==null) return false; rr+=r; cc+=c; } return true;
    }
    if((c1===this.cols-1&&c2===0&&r2===r1+1)||(c2===this.cols-1&&c1===0&&r1===r2+1)) return true;
    for(let i=Math.min(i1,i2)+1;i<Math.max(i1,i2);i++) if(this.numbers[i]!==null) return false;
    return true;
  }

  checkMatch(){
    const [i1,i2]=this.selected, n1=this.numbers[i1], n2=this.numbers[i2];
    const cells=this.gameEl.querySelectorAll('.cell');
    if((n1===n2||n1+n2===10)&&this.canConnect(i1,i2)){
      this.numbers[i1]=this.numbers[i2]=null;
      cells[i1].textContent=cells[i2].textContent='';
      this.selected.forEach(i=>cells[i].classList.remove('selected'));
      this.selected=[];
      this.compressRows();
      this.checkLevelComplete();
      this.blocked=false;
    } else {
      this.messageEl.textContent='Не можна поєднати!';
      this.selected.forEach(i=>this.animateCell(cells[i],'wrong',800,()=>{
        cells[i].classList.remove('selected');
        this.selected=[];
        this.messageEl.textContent='';
        this.blocked=false;
      }));
    }
    this.updateHintBlink();
  }

  compressRows(){
    let matrix=[]; for(let r=0;r<this.rows;r++) matrix.push(this.numbers.slice(r*this.cols,(r+1)*this.cols));
    matrix=matrix.filter(r=>r.some(n=>n!==null));
    while(matrix.length<this.rows) matrix.push(new Array(this.cols).fill(null));
    this.numbers=matrix.flat();
    this.renderGrid();
  }

  addRow(){
    if(this.blocked) return;
    let matrix=[]; for(let r=0;r<this.rows;r++) matrix.push(this.numbers.slice(r*this.cols,(r+1)*this.cols));
    let lastFilled=matrix.map(r=>r.some(n=>n!==null)).lastIndexOf(true);
    if(lastFilled<this.rows-1){
      const newRow=Array.from({length:this.cols},()=>Math.floor(Math.random()*9)+1);
      matrix.splice(lastFilled+1,0,newRow);
      if(matrix.length>this.rows) matrix=matrix.slice(0,this.rows);
      this.numbers=matrix.flat(); this.renderGrid();
    }
  }

  showHint(){
    if(this.blocked) return; this.blocked=true;
    const cells=this.gameEl.querySelectorAll('.cell');
    for(let i=0;i<this.numbers.length;i++){
      if(this.numbers[i]===null) continue;
      for(let j=i+1;j<this.numbers.length;j++){
        if(this.numbers[j]===null) continue;
        if((this.numbers[i]===this.numbers[j]||this.numbers[i]+this.numbers[j]===10)&&this.canConnect(i,j)){
          this.animateCell(cells[i],'hint',800); this.animateCell(cells[j],'hint',800,()=>{ this.blocked=false; }); return;
        }
      }
    }
    this.messageEl.textContent='Підказок немає!';
    setTimeout(()=>this.messageEl.textContent='',1000); this.blocked=false;
  }

  hasHint(){ for(let i=0;i<this.numbers.length;i++){ if(this.numbers[i]===null) continue; for(let j=i+1;j<this.numbers.length;j++){ if(this.numbers[j]===null) continue; if((this.numbers[i]===this.numbers[j]||this.numbers[i]+this.numbers[j]===10)&&this.canConnect(i,j)) return true; } } return false; }

  updateHintBlink(){ if(this.hasHint()) this.hintBtn.classList.add('blinking'); else this.hintBtn.classList.remove('blinking'); }

  checkLevelComplete(){ if(this.numbers.every(n=>n===null)){ this.level++; this.levelEl.textContent='Рівень: '+this.level; this.startGame(); } }
}

new NumberMatchGame();
</script>
</body>
</html>
